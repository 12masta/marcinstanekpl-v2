trigger:
  branches:
    include:
      - "*"

pr:
  branches:
    include:
      - "*"

pool:
  vmImage: 'ubuntu-20.04'

container: mcr.microsoft.com/playwright:focal

variables:
  - group: tokens

steps:
  - task: NodeTool@0
    inputs:
      versionSpec: "14.x"

  - script: npm install
    displayName: "npm install"

  - script: npm run build
    displayName: "Building site with gatsby under the hood"

  - script: npm run test-ci
    displayName: "Run playwirght tests"
  
  - task: PublishTestResults@2
    inputs:
      testResultsFormat: 'JUnit'
      testResultsFiles: '**/results.xml'
      testRunTitle: 'Playwright tests'

  - task: AzureStaticWebApp@0
    inputs:
      app_location: "/public/"
      output_location: "public"
      skip_app_build: true
      verbose: true
      azure_static_web_apps_api_token: "$(static-web-app-deployment-token)"
